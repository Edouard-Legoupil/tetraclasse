---
title: "tetraClass Model for satisfaction survey"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


Possibilities of the Llosa’s tetraclass model used for the measurement of consumer satisfaction and loyalty

<https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4139752>
https://link.springer.com/content/pdf/10.1057/palgrave.jt.5740099.pdf 

## The 4 type of criteria contributing to Satisfaction

The services provided by the companies are classified into one of 4 categories, according to the way in which they affect the clients’ experiences as follows:

 * __Basic__ services: these service elements contribute strongly to the clients’ overall level of __dissatisfaction__ when they are evaluated in an unfavorable fashion. However, when they are evaluated favorably, they contribute only weakly to client satisfaction;

 * __Plus__ services: these service elements contribute strongly to the overall level of client __satisfaction__ when they are evaluated favorably. When they are evaluated unfavorably they contribute weakly to the client’s dissatisfaction;

 * __Key__ services: these service elements contribute strongly to the degree of dissatisfaction or satisfaction of the client, __regardless__ of evaluation, negative or positive;

 * __Secondary__ services: these service elements have __little Influence__ on the level of overall satisfaction or dissatisfaction, whichever way they are evaluated.

By defining the important services for the area of interest and applying a correspondence analysis towards the data processing, a simple visual map is produced pointing at the place of the concrete services elements within the above four groups of basic, secondary, plus and key services.

The `tetraclass` model has the following advantages: 
 * It is based on clients own experiences of services and not a simulation, 
 * It allows to develop visual contribution charts, establishing the boundaries between categories of services elements clearly and not arbitrarily,
 It weight weighting criteria on the basis of their positive or negative performance.

## Developing the satisfaction survey



### Assessing global satisfaction

The first part of the questionnaire measures the global satisfaction of the consumer using three questions:

 * "It might be sad that I am satisfied of the service";

 * "I am happy that I am using the services of this pharmacy";

 * "I think that I have been always doing well when I was using the services of this center".
  
### Evaluate each criteria    
In the second part, every respondent is requested to evaluate the service criteria on a 5 points semantic-differential scale.


### Characterise respondent profile

Additional questions are focusing on different consumers characteristics as age , gender, level of education , distance between the community center and respondent home (from less that 1 Km to more than 10 Km) and the duration of the contact with the center (from less than 1 to more than 5 years). 

The changes shall be separately statistically analyzed in relation to respondents’ characteristics using the 2-tail z-test analysis assuming the two proportions are equal.


```{r fig.width=6, fig.height=6, fig.align='center'}
# ![](/inst/model.png)
library(tetraclasse)
library(magrittr)
library(reshape2)
library(tibble)
library(tidyr)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(unhcRstyle)
```

```{r fig.width=6, fig.height=6, fig.align='center'}
 # generate an example dataset with 150 respondant
 base <- gen_avis(150)
```


```{r fig.width=6, fig.height=6, fig.align='center'}
#prepare the dataset
base1 <- prepare_base(base)
dataset <- base1
```

```{r fig.width=6, fig.height=6, fig.align='center'}
# construct the Llosa matrix
# gen_llosa(base, 
#           annotate = TRUE,
#           annotatetext = c("Secondaire"," Plus","Basique","Clef"))

```

```{r fig.width=6, fig.height=6, fig.align='center'}
res <- dataset %>% 
          FactoMineR::CA() %>% 
          tetraclasse::Llosa() 
```

```{r fig.width=6, fig.height=6, fig.align='center'}
to.plot <- res$row$coord[,1,drop=FALSE] %>%
              as.data.frame() %>% 
              rownames_to_column() %>%
              separate(rowname,c("critere","sens")) %>%
              reshape2::dcast(critere~sens,value.var="Dim 1") 
```

```{r fig.width=6, fig.height=6, fig.align='center'}
to.plot[is.na(to.plot)] <- 0 
  #peut etre pas le plus intelligent, mais de toutes facon cela n'arrivera jamais dans une vrai enquete.

```

```{r fig.width=6, fig.height=6, fig.align='center'}
NN <- ggplot(data=to.plot , 
               aes(reorder(critere, negatif),negatif)) +
         geom_bar(stat="identity")+
         coord_flip() +
  labs(title = "Contribution to satisfaction ",
       subtitle = "if NEGATIVELY evaluated",
       x = "Criteria",
       y = "Contribution  ",
       caption = "Data Source: Satisfaction Survey " ) + 
  unhcRstyle::unhcr_theme(base_size = 11) +
  theme(#axis.text.x = element_blank(),
        # legend.position = "none",
        
        panel.grid.major.y = element_line(color = "#cbcbcb"), 
        panel.grid.major.x = element_line(color = "#cbcbcb") ) + 
  #geom_hline(yintercept = 0, size = 0.7, colour = "#333333")  + 
  geom_vline(xintercept = 0, size = 0.7, colour = "#333333")
  #theme_bw()
  theme_bw()
NN
```

```{r fig.width=6, fig.height=6, fig.align='center'}  
PP <- ggplot(data=to.plot ,
               aes(reorder(critere, -positif),positif)) +
         geom_bar(stat="identity")+
         coord_flip()+
  labs(title = "Contribution to satisfaction ",
       subtitle = "if POSITIVELY evaluated",
       x = "Criteria",
       y = "Contribution  ",
       caption = "Data Source: Satisfaction Survey " ) + 
  unhcRstyle::unhcr_theme(base_size = 11) +
  theme(#axis.text.x = element_blank(),
        # legend.position = "none",
        
        panel.grid.major.y = element_line(color = "#cbcbcb"), 
        panel.grid.major.x = element_line(color = "#cbcbcb") ) + 
  #geom_hline(yintercept = 0, size = 0.7, colour = "#333333")  + 
  geom_vline(xintercept = 0, size = 0.7, colour = "#333333")
  #theme_bw()
PP
```

```{r fig.width=6, fig.height=6, fig.align='center'}

to.plot$negatif <- to.plot$negatif - res$col$coord["negatif",1]
  
to.plot$positif <- -(to.plot$positif - res$col$coord["positif",1])

b <- max(abs(to.plot[,-1]),na.rm=TRUE)
  
p <- ggplot(data=to.plot,
              aes(negatif,
                  positif)) + 
        geom_point()+
        geom_hline(aes(yintercept=0))+
        geom_vline(aes(xintercept=0))+
        geom_text_repel(aes(label=critere)) +
  labs(title = "Satisfaction criteria categorization",
       subtitle = "TetraClass Model",
       
       x = "Contribution to satisfaction if NEGATIVELY evaluated",
       y = "Contribution to satisfaction if POSITIVELY evaluated",
       caption = "Data Source: Satisfaction Survey " ) +
  unhcRstyle::unhcr_theme(base_size = 11) +
  theme(#axis.text.x = element_blank(),
        # legend.position = "none",
        
        panel.grid.major.y = element_line(color = "#cbcbcb"), 
        panel.grid.major.x = element_line(color = "#cbcbcb") ) + 
  geom_hline(yintercept = 0, size = 0.7, colour = "#333333")  + 
  geom_vline(xintercept = 0, size = 0.7, colour = "#333333") 

p


```

```{r fig.width=6, fig.height=6, fig.align='center'}
#annotatetext = c("Secondaire"," Plus","Basique","Clef")
annotatetext = c("Secondary- little Influence"," Plus - satisfaction","Basic - disatisfaction","Key - regardless")
  
annotations <- data.frame(
    xpos = c(-Inf,-Inf,Inf,Inf),
    ypos =  c(-Inf, Inf,-Inf,Inf),
    annotatetext = annotatetext,
    hjustvar = c(0,0,1,1) ,
    vjustvar = c(0,1.0,0,1))

p <- p +   
        geom_text(data = annotations, 
                  aes(x=xpos,y=ypos,
                      hjust=hjustvar,
                      vjust=vjustvar,
                      label=annotatetext))

p
```
